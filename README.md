# Smart Auto Spend Tracker!

## Intro

happy to share this project that made my life in Mexico simpler and more fun. moving from europe, i found myself spending across different currencies â€“ day-to-day costs in MXN Peso, some in EURO, and subscriptions in Dollars. It was a nice opportunity to blend some Python, Cloud, and power of AI to craft a auto-spending tracker.

## Project Overview

This is a tool i built to track, categorize, and monitor my spending from multiple accounts, starting with Wise & PayPal, which I use the most. It utilizes Google Vertex AI 'Gemini Pro' to process and analyze my transaction data.

*Overall, this is how the entire project works.*

![Workflow](/images/Workflow.png)

## Features

- **Multi-Currency/Language Support:** Seamlessly handles MXN, EUR, USD / English, German.
- **Automated Tracking:** Integrates with email notifications for transaction alerts.
- **Intelligent Categorization:** Leverages AI to categorize & structure expenses.
- **Google Sheets Integration:** Presents a neat summary of expenses with details.
- **Open Source:** Shared with the community to inspire and innovate together.

## How It Works

1. **Transaction Notification:** As soon as I use Wise or PayPal at any moment, they notify me by sending an email and the new entry will added to my google sheet in the background. This entry includes date, time, merchant, amount, currency, account and category generated by AI - all in real time. What kicks this whole thing off is an email.

*with each transaction a new entry is added!*

![Output](/images/Output.png)

Rather than giving all bank credentials to other apps, I set my banks to email me for a transaction above the minimum limit!

2. **Function Trigger:** The Gmail API listens for new emails and triggers a parsing function.
3. **Prompting Gemini Pro:** The prompt is where magic happens! For this project that beauty is in turning any transaction details into useful data. For my use case, PayPal emails are in German, and Wise is in English, so I had to configure the model about this. So I went through several iterations for the prompt. But it still keeps growing.

I could give some sample output of what I would like the JSON to resemble, and then explain the details of the schema. It is amazing how just a few sentences and one example of what I wanted was enough for Gemini to understand my intention toward it and my expectations of the structure of the output. Finally, Gemini Pro enriches the transaction data and gives a category to the expenditure, and we get something like parsed transaction data:
```
{
'amount': '335', 
'currency': 'MXN', 
'merchant': 'Uber Eats', 
'category': 'Food & Dining', 
'date': '08-02-2024', 
'time': '20:25 PM', 
'account': 'Wise'
}
```

## Setup Instructions

### Prerequisites
1. Python 3.7 or higher
2. Google Cloud Account
3. Gmail Account
4. Google Sheets Account

### Step 1: Google Cloud Setup
1. Create a new project in Google Cloud Console
2. Enable the following APIs:
   - Gmail API
   - Google Sheets API
   - Vertex AI API
3. Create a Service Account and download the JSON key
4. Create OAuth 2.0 credentials and download as `credentials.json`

### Step 2: Environment Setup
1. Clone the repository
2. Install dependencies:
```bash
pip install -r requirements.txt
```
3. Create a `.env` file with the following variables:
```
API_ENDPOINT=your_vertex_ai_endpoint
SERVICE_ACCOUNT_FILE=path_to_service_account.json
PROJECT_ID=your_google_cloud_project_id
LOCATION=your_google_cloud_location
SPREADSHEET_ID=your_google_sheet_id
```

### Step 3: Google Sheets Setup
1. Create a new Google Sheet
2. Share it with the service account email
3. Copy the Spreadsheet ID from the URL
4. Add the sheet.gs script from Extensions > Apps Script

### Step 4: Email Setup
1. Configure your Wise account to send transaction notifications
2. Configure your PayPal account to send transaction notifications
3. Run the initial authentication:
```bash
python gmail_auth.py
```

## Usage

1. Start the tracker:
```bash
python api.py
```

2. The script will:
   - Monitor for new transaction emails
   - Parse transaction details
   - Use AI to categorize transactions
   - Update your Google Sheet automatically

## Error Handling

The system includes error handling for:
- API failures
- Email parsing issues
- Network connectivity problems
- Authentication errors

If you encounter any issues:
1. Check the logs
2. Verify your credentials
3. Ensure all APIs are enabled
4. Confirm environment variables are set correctly

## Contact

This took me 3 weekends to figure out and setup, hopefully with this code you can make it work in even less time! If you're curious about the project, want to contribute, or just say 'hola', feel free to reach out!

- **Email:** [[Email](mailto:babak.barghi@gmail.com)]
- **LinkedIn:** [[LinkdeIn](https://www.linkedin.com/in/babakbarghi/)]
